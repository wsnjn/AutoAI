# AutoAIé¡¹ç›®å®ç°è¿‡ç¨‹æ–‡æ¡£

# AutoAIæ™ºèƒ½ä»£ç åŠ©æ‰‹é¡¹ç›®å®ç°è¿‡ç¨‹æ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°

AutoAIæ˜¯ä¸€ä¸ªåŸºäºVue.js 3 + Node.js + MySQLçš„æ™ºèƒ½ä»£ç åŠ©æ‰‹å¹³å°ï¼Œé‡‡ç”¨äº‘å¼€å‘æ¨¡å¼ï¼Œæ”¯æŒå¤šç”¨æˆ·åä½œå¼€å‘ã€‚è¿™ä¸ªé¡¹ç›®æœ€å¤§çš„ç‰¹è‰²å°±æ˜¯é›†æˆäº†AIä»£ç ç”Ÿæˆã€3Dæ¨¡å‹äº¤äº’ã€å›¢é˜Ÿåä½œå’Œå¥½å‹èŠå¤©ç­‰å¤šç§åŠŸèƒ½äºä¸€ä½“ã€‚

### æŠ€æœ¯æ ˆè¯´æ˜

å‰ç«¯ä½¿ç”¨Vue 3 + Vue Router 4 + çº¯CSS + Three.js + Web Speech APIï¼Œåç«¯é‡‡ç”¨Node.js + Express + MySQL 8.0 + mysql2/promiseï¼ŒAIé›†æˆä½¿ç”¨DeepSeek APIã€‚æ•´ä¸ªé¡¹ç›®é‡‡ç”¨CDNæ–¹å¼éƒ¨ç½²ï¼Œé¿å…äº†å¤æ‚çš„ES6æ¨¡å—å¯¼å…¥é—®é¢˜ã€‚

## é¡¹ç›®æ„æ€é˜¶æ®µ

### 1. é¡¹ç›®èƒŒæ™¯

åœ¨2024å¹´ï¼Œéšç€AIæŠ€æœ¯çš„å¿«é€Ÿå‘å±•ï¼Œæˆ‘ä»¬æ„è¯†åˆ°ä¼ ç»Ÿçš„ä»£ç å¼€å‘æ–¹å¼éœ€è¦å˜é©ã€‚å¼€å‘è€…éœ€è¦ä¸€ä¸ªæ™ºèƒ½åŒ–çš„å¹³å°ï¼Œèƒ½å¤Ÿï¼š

- é€šè¿‡è‡ªç„¶è¯­è¨€æè¿°å¿«é€Ÿç”Ÿæˆä»£ç 
- å®æ—¶é¢„è§ˆå’Œè°ƒè¯•ä»£ç 
- æ”¯æŒå›¢é˜Ÿåä½œå¼€å‘
- æä¾›3Då¯è§†åŒ–å’Œè¯­éŸ³äº¤äº’
- é›†æˆAIåŠ©æ‰‹è¿›è¡Œæ™ºèƒ½ç¼–ç¨‹

### 2. æ ¸å¿ƒåŠŸèƒ½è®¾è®¡

åŸºäºä»¥ä¸Šéœ€æ±‚ï¼Œæˆ‘ä»¬è®¾è®¡äº†AutoAIçš„æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AutoAIæ ¸å¿ƒåŠŸèƒ½æ¨¡å—                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ AIä»£ç ç”Ÿæˆ   â”‚ â”‚ å®æ—¶é¢„è§ˆ    â”‚ â”‚ 3Då¯è§†åŒ–     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ å›¢é˜Ÿåä½œ     â”‚ â”‚ å¥½å‹èŠå¤©     â”‚ â”‚ è¯­éŸ³äº¤äº’     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. æŠ€æœ¯é€‰å‹

### å‰ç«¯æŠ€æœ¯æ ˆ

- **Vue 3**: é‡‡ç”¨Composition APIï¼Œæä¾›æ›´å¥½çš„TypeScriptæ”¯æŒå’Œæ€§èƒ½
- **Vue Router 4**: å•é¡µé¢åº”ç”¨è·¯ç”±ç®¡ç†
- **Three.js**: 3Dæ¨¡å‹æ¸²æŸ“å’Œäº¤äº’
- **Web Speech API**: è¯­éŸ³è¯†åˆ«å’Œåˆæˆ
- **çº¯CSS**: é¿å…å¤æ‚çš„CSSæ¡†æ¶ï¼Œæé«˜åŠ è½½é€Ÿåº¦

### åç«¯æŠ€æœ¯æ ˆ

- **Node.js + Express**: è½»é‡çº§WebæœåŠ¡å™¨
- **MySQL 8.0**: å…³ç³»å‹æ•°æ®åº“ï¼Œæ”¯æŒJSONå­—æ®µ
- **mysql2/promise**: å¼‚æ­¥MySQLè¿æ¥
- **DeepSeek API**: AIä»£ç ç”ŸæˆæœåŠ¡

## é¡¹ç›®å®ç°è¿‡ç¨‹

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¶æ„æ­å»º

### 1.1 é¡¹ç›®ç»“æ„åˆ›å»º

é¦–å…ˆåˆ›å»ºé¡¹ç›®çš„åŸºç¡€ç›®å½•ç»“æ„ï¼š

```bash
mkdir AutoAI
cd AutoAI
# å‰ç«¯é¡¹ç›®mkdir frontend
cd frontend
npm init vue@latest .
# åç«¯é¡¹ç›®mkdir backend
cd backend
npm init -y
```

### 1.2 æ•°æ®åº“è®¾è®¡

**é—®é¢˜1ï¼šå¦‚ä½•è®¾è®¡æ”¯æŒå¤šé¡¹ç›®çš„æ•°æ®åº“ç»“æ„ï¼Ÿ**

ä¼ ç»Ÿçš„å•è¡¨å­˜å‚¨æ–¹å¼æ— æ³•æ»¡è¶³å¤šé¡¹ç›®éš”ç¦»çš„éœ€æ±‚ã€‚æˆ‘ä»¬é‡‡ç”¨äº†åŠ¨æ€è¡¨åˆ›å»ºçš„è®¾è®¡ï¼š

```sql
-- é¡¹ç›®ä¸»è¡¨CREATE TABLE IF NOT EXISTS projects (
  id VARCHAR(50) PRIMARY KEY COMMENT 'é¡¹ç›®å”¯ä¸€æ ‡è¯†ç¬¦',
  name VARCHAR(100) NOT NULL COMMENT 'é¡¹ç›®åç§°',
  description TEXT COMMENT 'é¡¹ç›®æè¿°',
  type ENUM('html', 'vue', 'android', 'miniprogram', 'react') DEFAULT 'html',
  created_by VARCHAR(50) NOT NULL COMMENT 'åˆ›å»ºè€…ç”¨æˆ·å',
  created_by_id INT NOT NULL COMMENT 'åˆ›å»ºè€…ç”¨æˆ·ID',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**è§£å†³æ–¹æ¡ˆï¼šåŠ¨æ€è¡¨åˆ›å»ºæœºåˆ¶**

```jsx
// backend/services/projectService.js:577generateSafeTableName(projectName) {
  // ç§»é™¤ç‰¹æ®Šå­—ç¬¦ï¼Œåªä¿ç•™å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿  let safeName = projectName.replace(/[^a-zA-Z0-9_]/g, '_')
  // ç¡®ä¿è¡¨åä»¥å­—æ¯å¼€å¤´  if (!/^[a-zA-Z]/.test(safeName)) {
    safeName = 'project_' + safeName
  }
  // é™åˆ¶é•¿åº¦ï¼ˆMySQLè¡¨åæœ€å¤§64å­—ç¬¦ï¼‰  if (safeName.length > 60) {
    safeName = safeName.substring(0, 60)
  }
  return safeName.toLowerCase()
}
```

æ¯ä¸ªé¡¹ç›®éƒ½ä¼šåˆ›å»ºç‹¬ç«‹çš„æ•°æ®è¡¨ï¼š

```jsx
// backend/services/projectService.js:523const createProjectFileTable = `  CREATE TABLE IF NOT EXISTS \`${safeTableName}\` (    id INT AUTO_INCREMENT PRIMARY KEY COMMENT 'æ–‡ä»¶è®°å½•å”¯ä¸€æ ‡è¯†ç¬¦',    file_path VARCHAR(500) NOT NULL COMMENT 'æ–‡ä»¶å®Œæ•´è·¯å¾„',    file_name VARCHAR(255) NOT NULL COMMENT 'æ–‡ä»¶åï¼ˆä¸å«è·¯å¾„ï¼‰',    item_type ENUM('folder', 'file') NOT NULL COMMENT 'é¡¹ç›®ç±»å‹ï¼ˆæ–‡ä»¶å¤¹ã€æ–‡ä»¶ï¼‰',    file_type VARCHAR(50) COMMENT 'æ–‡ä»¶ç±»å‹æ‰©å±•åï¼ˆå¦‚txtã€vueã€jsç­‰ï¼‰',    file_size BIGINT DEFAULT 0 COMMENT 'æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰',    content LONGTEXT COMMENT 'æ–‡ä»¶å†…å®¹ï¼ˆæ–‡æœ¬æ–‡ä»¶ï¼‰',    parent_path VARCHAR(500) COMMENT 'çˆ¶ç›®å½•è·¯å¾„',    depth INT DEFAULT 0 COMMENT 'ç›®å½•å±‚çº§æ·±åº¦',    child_count INT DEFAULT 0 COMMENT 'å­é¡¹ç›®æ•°é‡',    file_count INT DEFAULT 0 COMMENT 'æ–‡ä»¶æ•°é‡',    folder_count INT DEFAULT 0 COMMENT 'æ–‡ä»¶å¤¹æ•°é‡',    last_modified TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,    created_by VARCHAR(100) COMMENT 'åˆ›å»ºè€…ç”¨æˆ·ID',    status ENUM('active', 'deleted') DEFAULT 'active' COMMENT 'é¡¹ç›®çŠ¶æ€',    UNIQUE KEY unique_path (file_path, status),    INDEX idx_file_path (file_path(255)),    INDEX idx_file_name (file_name),    INDEX idx_item_type (item_type),    INDEX idx_file_type (file_type),    INDEX idx_parent_path (parent_path(255)),    INDEX idx_status (status),    INDEX idx_created_at (created_at)  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='é¡¹ç›®æ–‡ä»¶å­˜å‚¨è¡¨'`
```

### 1.3 æ•°æ®åº“è¿æ¥é…ç½®

```jsx
// backend/config/database.jsconst mysql = require('mysql2/promise');const dbConfig = {
  host: process.env.DB_HOST || '39.108.142.250',  user: process.env.DB_USER || 'wslop',  password: process.env.DB_PASSWORD || '345345',  database: process.env.DB_NAME || 'autoai',  port: parseInt(process.env.DB_PORT) || 3306,  charset: 'utf8mb4',  timezone: process.env.DB_TIMEZONE || '+08:00',  connectionLimit: parseInt(process.env.DB_CONNECTION_LIMIT) || 10,  connectTimeout: parseInt(process.env.DB_CONNECT_TIMEOUT) || 60000,  family: 4};const pool = mysql.createPool(dbConfig);
```

### ç¬¬äºŒé˜¶æ®µï¼šAIä»£ç ç”ŸæˆåŠŸèƒ½å®ç°

### 2.1 AIæœåŠ¡é›†æˆ

**é—®é¢˜2ï¼šå¦‚ä½•è®©AIç†è§£é¡¹ç›®ç»“æ„å¹¶ç”Ÿæˆæ­£ç¡®çš„ä»£ç ï¼Ÿ**

æˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€ä¸ªæ™ºèƒ½çš„AIæç¤ºç³»ç»Ÿï¼Œè®©AIèƒ½å¤Ÿç†è§£é¡¹ç›®ç±»å‹å’Œç”¨æˆ·éœ€æ±‚ã€‚

```jsx
// backend/services/projectTypeService.jsconst projectTypes = {
  vue: {
    name: 'Vueé¡¹ç›®',    icon: 'ğŸ’š',    techStack: 'Vue3, Vue Router, Pinia, Element Plus',    aiPrompt: `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„Vue.jså‰ç«¯å¼€å‘ä¸“å®¶ã€‚è¯·å¸®åŠ©ç”¨æˆ·æ„å»ºä¸€ä¸ªç°ä»£åŒ–çš„Vue3é¡¹ç›®ã€‚é¡¹ç›®è¦æ±‚ï¼š- ä½¿ç”¨Vue 3 Composition API- ç»„ä»¶åŒ–å¼€å‘- å“åº”å¼è®¾è®¡- ä¸“æ³¨äºVueç»„ä»¶é¢„è§ˆé‡è¦ï¼šåªç”ŸæˆVueç»„ä»¶æ–‡ä»¶ï¼Œä¸ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼å…·ä½“è¦æ±‚ï¼š1. åªç”ŸæˆVueç»„ä»¶æ–‡ä»¶ï¼š   - src/App.vue (æ ¹ç»„ä»¶)   - src/views/ (é¡µé¢ç»„ä»¶ï¼Œ.vueæ–‡ä»¶)   - src/components/ (å…¬å…±ç»„ä»¶ï¼Œ.vueæ–‡ä»¶)2. æ–‡ä»¶æ ¼å¼è¦æ±‚ï¼š   - æ‰€æœ‰ç»„ä»¶ä½¿ç”¨.vueå•æ–‡ä»¶ç»„ä»¶æ ¼å¼   - æ¯ä¸ªç»„ä»¶éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå¯ä»¥å•ç‹¬é¢„è§ˆ   - ä¸ä½¿ç”¨å¤–éƒ¨ä¾èµ–ï¼Œæ‰€æœ‰ä»£ç å†…è”3. ä»£ç è§„èŒƒï¼š   - ä½¿ç”¨Vue 3 Composition API   - ç»„ä»¶ç»“æ„æ¸…æ™°ï¼ŒåŒ…å«templateã€scriptã€style   - å“åº”å¼è®¾è®¡   - ç»„ä»¶é—´é€šè¿‡propså’Œemité€šä¿¡   - æ ·å¼ä½¿ç”¨scopedé¿å…å†²çª`  }
}
```

### 2.2 AIä»£ç æ‰§è¡Œæœºåˆ¶

**é—®é¢˜3ï¼šå¦‚ä½•è®©AIçš„ä»£ç ä¿®æ”¹æŒ‡ä»¤ç›´æ¥æ“ä½œæ•°æ®åº“ï¼Ÿ**

æˆ‘ä»¬è®¾è®¡äº†AIä»£ç æ‰§è¡Œç³»ç»Ÿï¼Œè®©AIèƒ½å¤Ÿç›´æ¥åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤æ–‡ä»¶ï¼š

```jsx
// backend/services/aiService.js:70-85æ–‡ä»¶æ“ä½œæ ¼å¼ï¼š
å½“éœ€è¦åˆ›å»ºæ–°æ–‡ä»¶æ—¶ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼š
```è¯­è¨€ä»£ç å†…å®¹
```

åˆ›å»ºæ–‡ä»¶: æ–‡ä»¶å.æ‰©å±•å

å½“éœ€è¦ä¿®æ”¹ç°æœ‰æ–‡ä»¶æ—¶ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼š
æ–‡ä»¶æ“ä½œ: ä¿®æ”¹ æ–‡ä»¶å.æ‰©å±•å

```
ä»£ç å†…å®¹
```

å½“éœ€è¦åˆ é™¤æ–‡ä»¶æ—¶ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼š
æ–‡ä»¶æ“ä½œ: åˆ é™¤ æ–‡ä»¶å.æ‰©å±•å

```

AIä»£ç æ‰§è¡Œçš„æ ¸å¿ƒé€»è¾‘ï¼š

```javascript
// backend/services/aiService.js:704-752
async executeCodeModification(action, projectId, projectName) {
  try {
    console.log(`ğŸ”§ æ‰§è¡Œä»£ç ä¿®æ”¹: ${action.description}`);

    if (action.type === 'code_modification') {
      // è§£ææ–‡ä»¶åå’Œè·¯å¾„
      const fileName = this.extractFileName(action.description, action.language);

      // ä¿®å¤è·¯å¾„é‡å¤é—®é¢˜ï¼šæ­£ç¡®å¤„ç†æ–‡ä»¶è·¯å¾„
      let actualFileName, parentPath;
      if (fileName.includes('/')) {
        const pathParts = fileName.split('/');
        actualFileName = pathParts.pop(); // æœ€åä¸€éƒ¨åˆ†æ˜¯æ–‡ä»¶å
        parentPath = pathParts.join('/'); // å‰é¢çš„éƒ¨åˆ†æ˜¯çˆ¶è·¯å¾„
      } else {
        actualFileName = fileName;
        parentPath = '';
      }

      // ä¿å­˜æ–‡ä»¶åˆ°é¡¹ç›®æ•°æ®åº“
      const fileData = {
        file_name: actualFileName,
        file_type: path.extname(actualFileName).substring(1) || 'txt',
        file_size: action.code.length,
        content: action.code,
        is_directory: false,
        parent_path: parentPath,
        depth: parentPath ? parent_path.split('/').length : 0,
        created_by: 'ai_assistant'
      };

      // ä½¿ç”¨é¡¹ç›®æœåŠ¡ä¿å­˜æ–‡ä»¶
      const projectService = require('./projectService');
      const saveResult = await projectService.createFile(projectId, projectName, fileData);

      if (saveResult.success) {
        console.log(`âœ… æ–‡ä»¶ä¿å­˜åˆ°é¡¹ç›®æˆåŠŸ: ${filePath}`);

        // è®°å½•ä¿®æ”¹æ“ä½œ
        await this.logCodeModification(action, projectId);

        // è®°å½•é¡¹ç›®æ´»åŠ¨æ—¥å¿—
        await projectService.logProjectActivity(projectId, 1, 'file_created', {
          fileName: actualFileName,
          filePath: filePath,
          fileSize: action.code.length,
          description: 'AIåˆ›å»ºæ–‡ä»¶'
        });
      }
    }
  } catch (error) {
    console.error('âŒ æ‰§è¡Œä»£ç ä¿®æ”¹å¤±è´¥:', error);
  }
}
```

### 2.3 AIèŠå¤©ç•Œé¢å®ç°

```
<!-- frontend/src/components/AIChatBox.vue -->
<template>
  <div class="ai-chat-container">
    <div class="chat-header">
      <h3>ğŸ¤– DeepSeek AI åŠ©æ‰‹</h3>
      <div class="chat-status">
        <span :class="['status-indicator', { 'online': isConnected }]"></span>
        {{ isConnected ? 'å·²è¿æ¥' : 'è¿æ¥ä¸­...' }}
      </div>
    </div>

    <div class="chat-messages" ref="messagesContainer">
      <div
        v-for="(message, index) in messages"
        :key="index"
        :class="['message', message.role]"
      >
        <div class="message-avatar">
          {{ message.role === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–' }}
        </div>
        <div class="message-content">
          <div class="message-text" v-html="formatMessage(message.content)"></div>
          <div class="message-time">{{ formatTime(message.timestamp) }}</div>
          <div v-if="message.actions && message.actions.length > 0" class="message-actions">
            <div v-for="action in message.actions" :key="action.id" class="action-item">
              <span class="action-type">{{ action.type }}</span>
              <span class="action-description">{{ action.description }}</span>
            </div>
          </div>
        </div>
      </div>

      <div v-if="isLoading" class="message assistant">
        <div class="message-avatar">ğŸ¤–</div>
        <div class="message-content">
          <div class="loading-indicator">
            <div class="typing-dots">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="chat-input-section">
      <div class="input-container">
        <textarea
          v-model="userInput"
          @keydown.enter.prevent="sendMessage"
          placeholder="è¯·æè¿°æ‚¨æƒ³è¦å®ç°çš„åŠŸèƒ½æˆ–ä¿®æ”¹è¦æ±‚..."
          class="chat-input"
          :disabled="isLoading"
          rows="3"
        ></textarea>
        <button
          @click="sendMessage"
          class="send-btn"
          :disabled="isLoading || !userInput.trim()"
        >
          <span v-if="!isLoading">å‘é€</span>
          <span v-else>å‘é€ä¸­...</span>
        </button>
      </div>

      <div class="quick-actions">
        <button
          v-for="action in quickActions"
          :key="action.id"
          @click="useQuickAction(action)"
          class="quick-action-btn"
          :disabled="isLoading"
        >
          {{ action.label }}
        </button>
      </div>
    </div>
  </div>
</template>
```

### ç¬¬ä¸‰é˜¶æ®µï¼šå®æ—¶é¢„è§ˆç³»ç»Ÿå®ç°

### 3.1 é¢„è§ˆç»„ä»¶è®¾è®¡

**é—®é¢˜4ï¼šå¦‚ä½•å®ç°HTMLå’ŒVueæ–‡ä»¶çš„å®æ—¶é¢„è§ˆï¼Ÿ**

æˆ‘ä»¬è®¾è®¡äº†åŒæ¨¡å¼é¢„è§ˆç³»ç»Ÿï¼Œæ”¯æŒHTMLå’ŒVueç»„ä»¶çš„å®æ—¶é¢„è§ˆï¼š

```
<!-- frontend/src/components/ProjectPreview.vue -->
<template>
  <div class="preview-container">
    <div class="preview-header">
      <div class="tab-buttons">
        <button
          @click="activeTab = 'preview'"
          :class="['tab-btn', { active: activeTab === 'preview' }]"
        >
          ğŸ“„ é¢„è§ˆ
        </button>
        <button
          @click="activeTab = 'code'"
          :class="['tab-btn', { active: activeTab === 'code' }]"
        >
          ğŸ“ ä»£ç 
        </button>
      </div>
      <div class="preview-controls">
        <button @click="refreshPreview" class="btn-refresh" :disabled="loading">
          <span v-if="loading" class="spinner-small"></span>
          <span v-else>ğŸ”„</span>
          åˆ·æ–°
        </button>
        <button @click="openInNewTab" class="btn-new-tab" :disabled="!previewUrl">
          ğŸ”— æ–°çª—å£
        </button>
      </div>
    </div>

    <div class="preview-content">
      <!-- é¢„è§ˆæ¨¡å¼ -->
      <div v-if="activeTab === 'preview'">
        <div v-if="loading" class="loading-state">
          <div class="spinner"></div>
          <p>æ­£åœ¨åŠ è½½é¢„è§ˆ...</p>
        </div>

        <div v-else-if="error" class="error-state">
          <div class="error-icon">âŒ</div>
          <p>{{ error }}</p>
          <button @click="refreshPreview" class="btn-retry">é‡è¯•</button>
        </div>

        <div v-else class="preview-frame-container">
          <iframe
            ref="previewFrame"
            :src="previewUrl"
            class="preview-frame"
            frameborder="0"
            @load="onPreviewLoad"
            @error="onPreviewError"
          ></iframe>
        </div>
      </div>

      <!-- ä»£ç ç¼–è¾‘æ¨¡å¼ -->
      <div v-else-if="activeTab === 'code'" class="code-editor-container">
        <textarea v-model="codeContent" class="code-editor"></textarea>
        <div class="code-actions">
          <button @click="saveCode" :disabled="!hasChanges">ğŸ’¾ ä¿å­˜</button>
        </div>
      </div>
    </div>
  </div>
</template>
```

### 3.2 åç«¯é¢„è§ˆæœåŠ¡å®ç°

**é—®é¢˜5ï¼šVueç»„ä»¶é¢„è§ˆæ—¶å‡ºç°â€ref is not definedâ€é”™è¯¯**

Vueç»„ä»¶é¢„è§ˆéœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œå› ä¸ºéœ€è¦å¯¼å…¥Vueçš„Composition APIå‡½æ•°ï¼š

```jsx
// backend/index.js:1514-1661else if (file.file_name && file.file_name.endsWith('.vue')) {
  // Vueæ–‡ä»¶éœ€è¦åŒ…è£…æˆå¯è¿è¡Œçš„HTML  const vueContent = file.content  // è§£æVueç»„ä»¶å†…å®¹  const templateMatch = vueContent.match(/<template[^>]*>([\s\S]*?)<\/template>/);  const scriptMatch = vueContent.match(/<script[^>]*>([\s\S]*?)<\/script>/);  const styleMatch = vueContent.match(/<style[^>]*>([\s\S]*?)<\/style>/);  const template = templateMatch ? templateMatch[1].trim() : '<div>Vueç»„ä»¶</div>';  const script = scriptMatch ? scriptMatch[1].trim() : '';  const style = styleMatch ? styleMatch[1].trim() : '';  // åˆ›å»ºå¯è¿è¡Œçš„Vueåº”ç”¨  const htmlWrapper = `<!DOCTYPE html><html lang="zh-CN"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Vueç»„ä»¶é¢„è§ˆ - ${file.file_name}</title>    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>    <script src="https://unpkg.com/vue-router@4/dist/vue-router.global.js"></script>    <style>        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f5f5f5; }        .vue-preview-container { min-height: 100vh; display: flex; flex-direction: column; }        .vue-header { background: #42b883; color: white; padding: 15px 20px; font-weight: bold; }        .vue-preview-content { flex: 1; padding: 20px; background: white; margin: 20px; border-radius: 8px; }        .vue-component-container { border: 2px dashed #42b883; border-radius: 8px; padding: 20px; margin: 20px 0; }        ${style}    </style></head><body>    <div class="vue-preview-container">        <div class="vue-header">ğŸ¨ Vueç»„ä»¶å®æ—¶é¢„è§ˆ: ${file.file_name}</div>        <div class="vue-preview-content">            <div class="vue-component-container">                <h3>ğŸ“± ç»„ä»¶é¢„è§ˆæ•ˆæœ:</h3>                <div id="vue-app">${template}</div>            </div>        </div>    </div>    <script>        const { createApp, ref, reactive, computed, onMounted, onUnmounted } = Vue;        const { createRouter, createWebHashHistory } = VueRouter;        // è§£æVueç»„ä»¶è„šæœ¬        let componentConfig;        ${script ? `        try {          // ç§»é™¤ES6 importè¯­å¥ï¼Œé¿å…æ¨¡å—é”™è¯¯          let processedScript = \`${script}\`.replace(/import\\s+.*?from\\s+['"][^'"]+['"];?/g, '');          processedScript = processedScript.replace(/export\\s+default\\s+/g, 'componentConfig = ');          processedScript = processedScript.replace(/export\\s+\\{[^}]+\\}/g, '');          // æ‰§è¡Œå¤„ç†åçš„è„šæœ¬          eval(processedScript);        } catch (error) {          console.error('Vueç»„ä»¶è„šæœ¬è§£æé”™è¯¯:', error);        }        ` : ''}        // åˆ›å»ºVueåº”ç”¨        const app = createApp(componentConfig || {          data() {            return {              message: 'Hello Vue!'            }          }        });        app.mount('#vue-app');    </script></body></html>`;  res.setHeader('Content-Type', 'text/html; charset=utf-8')
  res.send(htmlWrapper)
}
```

**é—®é¢˜6ï¼šHTMLæ–‡ä»¶é¢„è§ˆæ—¶ç›¸å¯¹è·¯å¾„èµ„æºæ— æ³•åŠ è½½**

HTMLæ–‡ä»¶ä¸­çš„CSSã€JSã€å›¾ç‰‡ç­‰ç›¸å¯¹è·¯å¾„éœ€è¦è½¬æ¢ä¸ºAPIè·¯å¾„ï¼š

```jsx
// backend/index.js:1462-1506if (file.file_name && (file.file_name.endsWith('.html') || file.file_name.endsWith('.htm'))) {
  // HTMLæ–‡ä»¶éœ€è¦å¤„ç†ç›¸å¯¹èµ„æºè·¯å¾„  let htmlContent = file.content  // æ›¿æ¢CSSå’ŒJSçš„ç›¸å¯¹è·¯å¾„ä¸ºAPIè·¯å¾„  const baseApiUrl = `http://39.108.142.250:3000/api/projects/${projectId}/preview`  // å¤„ç†CSSæ–‡ä»¶å¼•ç”¨ï¼ˆåªå¤„ç†ç›¸å¯¹è·¯å¾„ï¼Œä¸å¤„ç†ç»å¯¹è·¯å¾„ï¼‰  htmlContent = htmlContent.replace(
    /href=["']([^"']*\.css)["']/g,
    (match, path) => {
      // å¦‚æœæ˜¯ç»å¯¹è·¯å¾„ï¼ˆä»¥http://æˆ–https://å¼€å¤´ï¼‰ï¼Œä¸å¤„ç†      if (path.startsWith('http://') || path.startsWith('https://')) {
        return match
      }
      // åªå¤„ç†ç›¸å¯¹è·¯å¾„      return `href="${baseApiUrl}?filePath=${path}"`    }
  )
  // å¤„ç†JS/TSæ–‡ä»¶å¼•ç”¨ï¼ˆåªå¤„ç†ç›¸å¯¹è·¯å¾„ï¼Œä¸å¤„ç†ç»å¯¹è·¯å¾„ï¼‰  htmlContent = htmlContent.replace(
    /src=["']([^"']*\.(js|ts))["']/g,
    (match, path) => {
      // å¦‚æœæ˜¯ç»å¯¹è·¯å¾„ï¼ˆä»¥http://æˆ–https://å¼€å¤´ï¼‰ï¼Œä¸å¤„ç†      if (path.startsWith('http://') || path.startsWith('https://')) {
        return match
      }
      // åªå¤„ç†ç›¸å¯¹è·¯å¾„      return `src="${baseApiUrl}?filePath=${path}"`    }
  )
  // å¤„ç†å›¾ç‰‡æ–‡ä»¶å¼•ç”¨ï¼ˆåªå¤„ç†ç›¸å¯¹è·¯å¾„ï¼Œä¸å¤„ç†ç»å¯¹è·¯å¾„ï¼‰  htmlContent = htmlContent.replace(
    /src=["']([^"']*\.(png|jpg|jpeg|gif|svg|webp))["']/g,
    (match, path) => {
      // å¦‚æœæ˜¯ç»å¯¹è·¯å¾„ï¼ˆä»¥http://æˆ–https://å¼€å¤´ï¼‰ï¼Œä¸å¤„ç†      if (path.startsWith('http://') || path.startsWith('https://')) {
        return match
      }
      // åªå¤„ç†ç›¸å¯¹è·¯å¾„      return `src="${baseApiUrl}?filePath=${path}"`    }
  )
  res.setHeader('Content-Type', 'text/html; charset=utf-8')
  res.setHeader('Cache-Control', 'no-cache, no-store, must-revalidate')
  res.setHeader('Pragma', 'no-cache')
  res.setHeader('Expires', '0')
  res.send(htmlContent)
}
```

### ç¬¬å››é˜¶æ®µï¼šæ–‡ä»¶ç®¡ç†ç³»ç»Ÿå®ç°

### 4.1 æ–‡ä»¶æ ‘ç»„ä»¶å®ç°

**é—®é¢˜7ï¼šå¦‚ä½•å®ç°é€’å½’çš„æ–‡ä»¶æ ‘ç»“æ„ï¼Ÿ**

æˆ‘ä»¬è®¾è®¡äº†é€’å½’çš„FileTreeNodeç»„ä»¶ï¼š

```
<!-- frontend/src/components/FileTreeNode.vue -->
<template>
  <div class="file-tree-node">
    <div class="node-content" @click="toggleExpand">
      <div class="node-icon">
        <span v-if="item.item_type === 'folder'">ğŸ“</span>
        <span v-else>{{ getFileIcon(item.file_type) }}</span>
      </div>
      <div class="node-info">
        <div class="node-name">{{ item.file_name }}</div>
        <div class="node-meta">
          <span v-if="item.item_type === 'file'">{{ formatBytes(item.file_size) }}</span>
          <span v-else>{{ item.child_count }} ä¸ªé¡¹ç›®</span>
        </div>
      </div>
      <div class="node-actions">
        <button @click.stop="viewItem" class="action-btn">ğŸ‘ï¸</button>
        <button @click.stop="editItem" class="action-btn">âœï¸</button>
        <button @click.stop="deleteItem" class="action-btn">ğŸ—‘ï¸</button>
      </div>
    </div>

    <div v-if="item.item_type === 'folder' && item.children && item.children.length > 0"
         class="node-children"
         :class="{ 'expanded': item.expanded }">
      <FileTreeNode
        v-for="child in item.children"
        :key="child.id"
        :item="child"
        :project-id="projectId"
        @refresh="$emit('refresh')"
        @file-selected="$emit('file-selected', $event)"
        @edit-item="$emit('edit-item', $event)"
      />
    </div>
  </div>
</template>

<script>
export default {
  name: 'FileTreeNode',
  props: {
    item: {
      type: Object,
      required: true
    },
    projectId: {
      type: String,
      required: true
    }
  },
  methods: {
    getFileIcon(fileType) {
      const iconMap = {
        'js': 'ğŸ“œ', 'ts': 'ğŸ“œ', 'jsx': 'âš›ï¸', 'tsx': 'âš›ï¸',
        'vue': 'ğŸ’š', 'html': 'ğŸŒ', 'css': 'ğŸ¨', 'scss': 'ğŸ¨',
        'json': 'ğŸ“‹', 'md': 'ğŸ“', 'txt': 'ğŸ“„'
      }
      return iconMap[fileType] || 'ğŸ“„'
    },

    formatBytes(bytes) {
      if (bytes === 0) return '0 Bytes'
      const k = 1024
      const sizes = ['Bytes', 'KB', 'MB', 'GB']
      const i = Math.floor(Math.log(bytes) / Math.log(k))
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]
    },

    viewItem() {
      console.log('ğŸ” FileTreeNode viewItem clicked:', this.item)
      this.$emit('file-selected', this.item)
    },

    editItem() {
      console.log('âœï¸ FileTreeNode editItem clicked:', this.item)
      this.$emit('edit-item', this.item)
    },

    async deleteItem() {
      // é˜²æ­¢é‡å¤åˆ é™¤
      if (this.deleting) {
        console.log('â³ åˆ é™¤æ“ä½œè¿›è¡Œä¸­ï¼Œè·³è¿‡é‡å¤è¯·æ±‚')
        return
      }

      const deleteKey = `${this.projectId}-${this.item.file_path}`
      if (window.deletingFiles && window.deletingFiles.has(deleteKey)) {
        console.log('â³ æ–‡ä»¶æ­£åœ¨åˆ é™¤ä¸­ï¼Œè·³è¿‡é‡å¤è¯·æ±‚')
        return
      }

      if (!window.deletingFiles) {
        window.deletingFiles = new Set()
      }
      window.deletingFiles.add(deleteKey)
      this.deleting = true

      try {
        console.log('ğŸ—‘ï¸ å¼€å§‹åˆ é™¤æ–‡ä»¶:', this.item.file_name)

        const response = await fetch(`http://39.108.142.250:3000/api/projects/${this.projectId}/items`, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            fileName: this.item.file_name,
            filePath: this.item.file_path
          })
        })

        const result = await response.json()

        if (result.success) {
          console.log('âœ… æ–‡ä»¶åˆ é™¤æˆåŠŸ')
          this.$emit('refresh')
        } else {
          console.log('âŒ åˆ é™¤å¤±è´¥:', result.error)
          if (result.error.includes('æ–‡ä»¶å·²ç»è¢«åˆ é™¤')) {
            console.log('æ–‡ä»¶å·²è¢«åˆ é™¤ï¼Œåˆ·æ–°åˆ—è¡¨')
            this.$emit('refresh')
          }
        }
      } catch (error) {
        console.error('âŒ åˆ é™¤æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯:', error)
      } finally {
        this.deleting = false
        if (window.deletingFiles) {
          window.deletingFiles.delete(deleteKey)
        }
      }
    }
  }
}
</script>
```

### 4.2 è½¯åˆ é™¤æœºåˆ¶å®ç°

**é—®é¢˜8ï¼šæ–‡ä»¶åˆ é™¤åä»ç„¶æ˜¾ç¤ºåœ¨åˆ—è¡¨ä¸­**

æˆ‘ä»¬å®ç°äº†è½¯åˆ é™¤æœºåˆ¶ï¼Œæ–‡ä»¶åˆ é™¤æ—¶åªæ ‡è®°çŠ¶æ€ï¼Œä¸ç‰©ç†åˆ é™¤ï¼š

```jsx
// backend/services/projectService.js:1829-1832async deleteFile(projectId, fileName, filePath) {
  try {
    console.log(`ğŸ—‘ï¸ å¼€å§‹åˆ é™¤æ–‡ä»¶: ${fileName} (${filePath})`)
    const projectResult = await this.getProject(projectId)
    if (!projectResult.success) {
      return { success: false, error: 'é¡¹ç›®ä¸å­˜åœ¨' }
    }
    const project = projectResult.data    const safeTableName = this.generateSafeTableName(project.name)
    // è½¯åˆ é™¤ï¼šä½¿ç”¨æ›´å®‰å…¨çš„æ–¹å¼é¿å…å”¯ä¸€çº¦æŸå†²çª    const deletedPath = `${filePath}-deleted-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`    const [result] = await pool.execute(
      `UPDATE \`${safeTableName}\` SET status = 'deleted', file_path = ?, last_modified = CURRENT_TIMESTAMP WHERE file_name = ? AND file_path = ?`,      [deletedPath, fileName, filePath]
    )
    if (result.affectedRows > 0) {
      console.log(`âœ… æ–‡ä»¶è½¯åˆ é™¤æˆåŠŸ: ${fileName}`)
      return { success: true, message: 'æ–‡ä»¶åˆ é™¤æˆåŠŸ' }
    } else {
      console.log(`âš ï¸ æ–‡ä»¶ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤: ${fileName}`)
      return { success: false, error: 'æ–‡ä»¶ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤' }
    }
  } catch (error) {
    console.error('âŒ åˆ é™¤æ–‡ä»¶å¤±è´¥:', error)
    return { success: false, error: 'åˆ é™¤æ–‡ä»¶å¤±è´¥' }
  }
}
```

**é—®é¢˜9ï¼šå·²åˆ é™¤æ–‡ä»¶ä»ç„¶æ˜¾ç¤ºåœ¨æ–‡ä»¶åˆ—è¡¨ä¸­**

æ–‡ä»¶åˆ—è¡¨æŸ¥è¯¢æ—¶éœ€è¦è¿‡æ»¤å·²åˆ é™¤çš„æ–‡ä»¶ï¼š

```jsx
// backend/services/projectService.js:908-971async getProjectFilesSimple(projectId, projectName) {
  try {
    console.log(`ğŸ“ è·å–é¡¹ç›®æ–‡ä»¶åˆ—è¡¨: ${projectName}`)
    const safeTableName = this.generateSafeTableName(projectName)
    // è·å–æ‰€æœ‰ç›¸å…³è¡¨    const [tables] = await pool.execute(`SHOW TABLES LIKE '${safeTableName}%'`)
    let allFiles = []
    for (const table of tables) {
      const tableName = Object.values(table)[0]
      // æè¿°è¡¨ç»“æ„      const [columns] = await pool.execute(`DESCRIBE \`${tableName}\``)
      const columnNames = columns.map(col => col.Field)
      // æ„å»ºæŸ¥è¯¢è¯­å¥      let query = `SELECT * FROM \`${tableName}\` WHERE status = 'active'`      // æ·»åŠ parent_pathæ¡ä»¶ï¼ˆå¦‚æœå­˜åœ¨è¯¥åˆ—ï¼‰      if (columnNames.includes('parent_path')) {
        query += ` AND (parent_path IS NULL OR parent_path = '')`      }
      // åŠ¨æ€ORDER BY      if (columnNames.includes('file_name')) {
        query += ` ORDER BY file_name ASC`      } else if (columnNames.includes('name')) {
        query += ` ORDER BY name ASC`      } else {
        query += ` ORDER BY id ASC`      }
      const [files] = await pool.execute(query)
      allFiles = allFiles.concat(files)
    }
    console.log(`âœ… è·å–åˆ° ${allFiles.length} ä¸ªæ–‡ä»¶`)
    return {
      success: true,      data: allFiles,      tableName: safeTableName
    }
  } catch (error) {
    console.error('âŒ è·å–é¡¹ç›®æ–‡ä»¶åˆ—è¡¨å¤±è´¥:', error)
    return { success: false, error: 'è·å–é¡¹ç›®æ–‡ä»¶åˆ—è¡¨å¤±è´¥' }
  }
}
```

### ç¬¬äº”é˜¶æ®µï¼š3Då¯è§†åŒ–ç³»ç»Ÿå®ç°

### 5.1 Three.jsé›†æˆ

**é—®é¢˜10ï¼šå¦‚ä½•é›†æˆ3Dæ¨¡å‹æŸ¥çœ‹å™¨ï¼Ÿ**

æˆ‘ä»¬ä½¿ç”¨Three.jsåˆ›å»ºäº†3Dæ¨¡å‹æŸ¥çœ‹å™¨ï¼š

```
<!-- frontend/src/components/ModelViewer.vue -->
<template>
  <div class="model-viewer">
    <div id="model-container" ref="modelContainer"></div>
  </div>
</template>

<script setup>
import { ref, onMounted, onBeforeUnmount, watch } from 'vue'
import * as THREE from 'three'
import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js'
import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js'

const props = defineProps({
  currentModelName: {
    type: String,
    default: 'cute_home_robot.glb'
  }
})

const modelContainer = ref(null)
let scene, camera, renderer, model, controls
let animationFrameId, mixer, clock = new THREE.Clock()

async function loadModel(modelName) {
  console.log('ğŸ® å¼€å§‹åŠ è½½æ¨¡å‹', modelName)

  if (!modelContainer.value) {
    console.error('âŒ modelContainer æœªæ‰¾åˆ°')
    return
  }

  // æ¸…é™¤æ—§æ¨¡å‹å’ŒåŠ¨ç”»
  if (model) {
    scene.remove(model)
    model = null
  }
  if (mixer) {
    mixer.stopAllAction()
    mixer = null
  }

  // åˆå§‹åŒ–åœºæ™¯ï¼ˆåªåœ¨ç¬¬ä¸€æ¬¡åŠ è½½æ—¶æ‰§è¡Œï¼‰
  if (!scene) {
    console.log('ğŸŒ åˆå§‹åŒ–Three.jsåœºæ™¯')
    scene = new THREE.Scene()
    scene.background = new THREE.Color(0xf0f0f0)

    camera = new THREE.PerspectiveCamera(
      75,
      modelContainer.value.clientWidth / modelContainer.value.clientHeight,
      0.1,
      1000
    )
    camera.position.set(0, 2, 4)

    renderer = new THREE.WebGLRenderer({ antialias: true })
    renderer.setSize(modelContainer.value.clientWidth, modelContainer.value.clientHeight)
    modelContainer.value.appendChild(renderer.domElement)

    controls = new OrbitControls(camera, renderer.domElement)
    controls.enablePan = false
    controls.enableZoom = false
    controls.enableRotate = true
    controls.enableDamping = true
    controls.dampingFactor = 0.05
    controls.target.set(0, 0, 0)
    controls.update()

    // æ·»åŠ å…‰ç…§
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5)
    scene.add(ambientLight)

    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8)
    directionalLight.position.set(0, 1, 1)
    scene.add(directionalLight)

    console.log('âœ… Three.jsåœºæ™¯åˆå§‹åŒ–å®Œæˆ')
    animate()
  }

  // åŠ è½½å½“å‰æ¨¡å‹
  const loader = new GLTFLoader()
  const modelUrl = `/models/${modelName}`

  try {
    console.log('ğŸ”„ å¼€å§‹åŠ è½½GLBæ¨¡å‹...')
    const gltf = await loader.loadAsync(modelUrl)
    console.log('âœ… æ¨¡å‹åŠ è½½æˆåŠŸ:', gltf)

    model = gltf.scene

    // æ ¹æ®æ¨¡å‹ç±»å‹è°ƒæ•´ä½ç½®å’Œç¼©æ”¾
    if (modelName.includes('robot')) {
      model.scale.setScalar(0.8)
      model.position.set(0, -0.5, 0)
    }

    scene.add(model)

    // å¤„ç†åŠ¨ç”»
    if (gltf.animations && gltf.animations.length > 0) {
      mixer = new THREE.AnimationMixer(model)
      gltf.animations.forEach(animation => {
        mixer.clipAction(animation).play()
      })
    }

    console.log('âœ… æ¨¡å‹åŠ è½½æˆåŠŸ')
  } catch (error) {
    console.error('âŒ æ¨¡å‹åŠ è½½å¤±è´¥:', error)
  }
}

function animate() {
  animationFrameId = requestAnimationFrame(animate)

  if (mixer) {
    mixer.update(clock.getDelta())
  }

  if (controls) {
    controls.update()
  }

  if (renderer && scene && camera) {
    renderer.render(scene, camera)
  }
}

onMounted(() => {
  loadModel(props.currentModelName)
})

onBeforeUnmount(() => {
  if (animationFrameId) {
    cancelAnimationFrame(animationFrameId)
  }
  if (renderer) {
    renderer.dispose()
  }
})

watch(() => props.currentModelName, (newModelName) => {
  loadModel(newModelName)
})
</script>
```

### 5.2 è¯­éŸ³äº¤äº’å®ç°

**é—®é¢˜11ï¼šå¦‚ä½•å®ç°3Dæ¨¡å‹ä¸è¯­éŸ³çš„äº¤äº’ï¼Ÿ**

æˆ‘ä»¬é›†æˆäº†Web Speech APIï¼Œå®ç°äº†è¯­éŸ³è¯†åˆ«å’Œè¯­éŸ³åˆæˆï¼š

```jsx
// frontend/src/components/ThreeModelViewer.vue:206-257startSpeechRecognition() {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;  if (!SpeechRecognition) {
    alert("ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«");    return Promise.reject("Speech recognition not supported");  }
  const recognition = new SpeechRecognition();  recognition.lang = 'zh-CN';  recognition.interimResults = false;  recognition.maxAlternatives = 1;  return new Promise((resolve, reject) => {
    recognition.onstart = () => {
      console.log("ğŸ¤ å¼€å§‹ç›‘å¬ï¼Œè¯·è®²è¯...");    };    recognition.onerror = (event) => {
      console.error("è¯­éŸ³è¯†åˆ«é”™è¯¯:", event.error);      this.speak("æŠ±æ­‰ï¼Œæˆ‘æ²¡æœ‰å¬æ¸…æ¥šï¼Œè¯·å†è¯´ä¸€éï¼");      reject(new Error("Speech recognition error: " + event.error));    };    recognition.onresult = (event) => {
      const transcript = event.results[0][0].transcript;      console.log("ğŸ—£ï¸ ä½ è¯´çš„æ˜¯:", transcript);      // é¦–å…ˆæ£€æŸ¥æ˜¯å¦åŒ¹é…é¢„è®¾ç­”æ¡ˆ      if (this.checkPresetAnswers(transcript)) {
        console.log("æ£€æµ‹åˆ°é¢„è®¾ç­”æ¡ˆï¼Œå·²æ‰§è¡Œå¯¹åº”æ“ä½œ");      }
      // ç„¶åæ£€æŸ¥æ˜¯å¦æ˜¯å¿«æ·æŒ‡ä»¤      else if (this.checkAndExecuteVoiceCommands(transcript)) {
        console.log("æ£€æµ‹åˆ°å¿«æ·æŒ‡ä»¤ï¼Œå·²æ‰§è¡Œå¯¹åº”æ“ä½œ");      }
      // å¦‚æœæ—¢ä¸æ˜¯é¢„è®¾ç­”æ¡ˆä¹Ÿä¸æ˜¯å¿«æ·æŒ‡ä»¤ï¼Œå‘é€åˆ°AIèŠå¤©é¡µé¢      else {
        this.sendToAIChat(transcript);      }
      resolve(transcript);    };    recognition.onend = () => {
      console.log("è¯­éŸ³è¯†åˆ«ç»“æŸ");    };    recognition.start();  });},// æ£€æŸ¥é¢„è®¾ç­”æ¡ˆcheckPresetAnswers(text) {
  for (const [keyword, answer] of Object.entries(this.presetAnswers)) {
    if (text.includes(keyword)) {
      console.log(`æ£€æµ‹åˆ°é¢„è®¾ç­”æ¡ˆå…³é”®è¯: ${keyword}`);      this.speak(answer);      return true;    }
  }
  return false;},// æ£€æŸ¥å¿«æ·æŒ‡ä»¤checkAndExecuteVoiceCommands(text) {
  for (const [command, action] of Object.entries(this.voiceCommands)) {
    if (text.includes(command)) {
      console.log(`æ£€æµ‹åˆ°å¿«æ·æŒ‡ä»¤: ${command}`);      action();      return true;    }
  }
  return false;},// è¯­éŸ³åˆæˆspeak(text) {
  if (!window.speechSynthesis) {
    alert("å½“å‰æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆ");    return;  }
  const utterance = new SpeechSynthesisUtterance(text);  utterance.lang = 'zh-CN';  utterance.rate = 0.9;  utterance.pitch = 1;  utterance.volume = 0.8;  window.speechSynthesis.speak(utterance);}
```

### ç¬¬å…­é˜¶æ®µï¼šå›¢é˜Ÿåä½œåŠŸèƒ½å®ç°

### 6.1 å›¢é˜Ÿç®¡ç†ç•Œé¢

**é—®é¢˜12ï¼šå¦‚ä½•å®ç°é¡¹ç›®æˆå‘˜ç®¡ç†ï¼Ÿ**

æˆ‘ä»¬è®¾è®¡äº†å›¢é˜Ÿç®¡ç†ç•Œé¢ï¼Œæ”¯æŒæˆå‘˜é‚€è¯·ã€ç§»é™¤ã€æ‹‰é»‘ç­‰åŠŸèƒ½ï¼š

```
<!-- frontend/src/views/Team.vue -->
<template>
  <div class="team-container">
    <h2>å›¢é˜Ÿç®¡ç†</h2>

    <!-- æˆ‘çš„é¡¹ç›®åˆ—è¡¨ -->
    <div class="projects-section">
      <h3>æˆ‘åˆ›å»ºçš„é¡¹ç›®</h3>
      <div v-for="project in myProjects" :key="project.id" class="project-item">
        <div class="project-header" @click="toggleProjectExpand(project.id)">
          <span class="project-name">{{ project.name }}</span>
          <span class="member-count">{{ project.memberCount }} ä¸ªæˆå‘˜</span>
          <span class="expand-icon">{{ project.expanded ? 'â–¼' : 'â–¶' }}</span>
        </div>

        <!-- é¡¹ç›®æˆå‘˜ç®¡ç† -->
        <div v-if="project.expanded" class="members-section">
          <div class="member-list">
            <div v-for="member in project.members" :key="member.id" class="member-item">
              <span class="member-name">{{ member.username }}</span>
              <span class="member-role">{{ getRoleText(member.role) }}</span>
              <span class="member-status">{{ getStatusText(member.status) }}</span>
              <div class="member-actions">
                <button @click="removeMember(project.id, member.user_id)">ç§»é™¤</button>
                <button @click="toggleBanMember(project.id, member.user_id)">
                  {{ member.status === 'active' ? 'æ‹‰é»‘' : 'è§£å°' }}
                </button>
              </div>
            </div>
          </div>

          <!-- é‚€è¯·æ–°æˆå‘˜ -->
          <div class="invite-section">
            <button @click="openInviteModal(project.id)">é‚€è¯·æˆå‘˜</button>
          </div>
        </div>
      </div>
    </div>

    <!-- é‚€è¯·æ¨¡æ€æ¡† -->
    <div v-if="showInviteModal" class="modal-overlay" @click="closeInviteModal">
      <div class="modal-content" @click.stop>
        <h3>é‚€è¯·æˆå‘˜</h3>
        <div class="form-group">
          <label>ç”¨æˆ·å:</label>
          <input v-model="inviteForm.username" type="text" placeholder="è¾“å…¥è¦é‚€è¯·çš„ç”¨æˆ·å">
        </div>
        <div class="form-group">
          <label>é‚€è¯·æ¶ˆæ¯:</label>
          <textarea v-model="inviteForm.message" placeholder="è¾“å…¥é‚€è¯·æ¶ˆæ¯"></textarea>
        </div>
        <div class="modal-actions">
          <button @click="sendInvite" :disabled="!inviteForm.username">å‘é€é‚€è¯·</button>
          <button @click="closeInviteModal">å–æ¶ˆ</button>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      myProjects: [],
      showInviteModal: false,
      inviteForm: {
        username: '',
        message: ''
      }
    }
  },

  async mounted() {
    await this.loadMyProjects()
  },

  methods: {
    async loadMyProjects() {
      try {
        const currentUser = JSON.parse(localStorage.getItem('currentUser'))
        const response = await fetch(`http://39.108.142.250:3000/api/team/my-projects/${currentUser.id}`)
        const result = await response.json()

        if (result.success) {
          this.myProjects = result.data.map(project => ({
            ...project,
            expanded: false,
            members: []
          }))
        }
      } catch (error) {
        console.error('åŠ è½½æˆ‘çš„é¡¹ç›®å¤±è´¥:', error)
      }
    },

    async toggleProjectExpand(projectId) {
      const project = this.myProjects.find(p => p.id === projectId)
      if (project) {
        project.expanded = !project.expanded
        if (project.expanded && project.members.length === 0) {
          await this.loadProjectMembers(projectId)
        }
      }
    },

    async loadProjectMembers(projectId) {
      try {
        const response = await fetch(`http://39.108.142.250:3000/api/team/project-members/${projectId}`)
        const result = await response.json()

        if (result.success) {
          const project = this.myProjects.find(p => p.id === projectId)
          if (project) {
            project.members = result.data
            project.memberCount = result.data.length
          }
        }
      } catch (error) {
        console.error('åŠ è½½é¡¹ç›®æˆå‘˜å¤±è´¥:', error)
      }
    },

    async removeMember(projectId, userId) {
      try {
        const response = await fetch('http://39.108.142.250:3000/api/team/remove-member', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            projectId: projectId,
            userId: userId
          })
        })

        const result = await response.json()

        if (result.success) {
          alert('æˆå‘˜ç§»é™¤æˆåŠŸ')
          await this.loadProjectMembers(projectId)
        } else {
          alert('ç§»é™¤å¤±è´¥: ' + result.error)
        }
      } catch (error) {
        console.error('ç§»é™¤æˆå‘˜å¤±è´¥:', error)
        alert('ç§»é™¤æˆå‘˜å¤±è´¥')
      }
    },

    async toggleBanMember(projectId, userId) {
      try {
        const response = await fetch('http://39.108.142.250:3000/api/team/toggle-ban-member', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            projectId: projectId,
            userId: userId
          })
        })

        const result = await response.json()

        if (result.success) {
          alert(result.message)
          await this.loadProjectMembers(projectId)
        } else {
          alert('æ“ä½œå¤±è´¥: ' + result.error)
        }
      } catch (error) {
        console.error('åˆ‡æ¢æˆå‘˜çŠ¶æ€å¤±è´¥:', error)
        alert('æ“ä½œå¤±è´¥')
      }
    },

    openInviteModal(projectId) {
      this.inviteForm.projectId = projectId
      this.showInviteModal = true
    },

    closeInviteModal() {
      this.showInviteModal = false
      this.inviteForm = {
        username: '',
        message: ''
      }
    },

    async sendInvite() {
      try {
        const response = await fetch('http://39.108.142.250:3000/api/team/invite-member', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            projectId: this.inviteForm.projectId,
            username: this.inviteForm.username,
            message: this.inviteForm.message
          })
        })

        const result = await response.json()

        if (result.success) {
          alert('é‚€è¯·å‘é€æˆåŠŸ')
          this.closeInviteModal()
        } else {
          alert('é‚€è¯·å¤±è´¥: ' + result.error)
        }
      } catch (error) {
        console.error('å‘é€é‚€è¯·å¤±è´¥:', error)
        alert('å‘é€é‚€è¯·å¤±è´¥')
      }
    },

    getRoleText(role) {
      const roleMap = {
        'owner': 'é¡¹ç›®æ‰€æœ‰è€…',
        'member': 'æ™®é€šæˆå‘˜'
      }
      return roleMap[role] || role
    },

    getStatusText(status) {
      const statusMap = {
        'active': 'æ­£å¸¸',
        'inactive': 'å·²æ‹‰é»‘',
        'removed': 'å·²ç§»é™¤'
      }
      return statusMap[status] || status
    }
  }
}
</script>
```

### 6.2 åç«¯å›¢é˜Ÿç®¡ç†API

```jsx
// backend/index.js:å›¢é˜Ÿç®¡ç†API// è·å–æˆ‘åˆ›å»ºçš„é¡¹ç›®app.get('/api/team/my-projects/:userId', async (req, res) => {
  try {
    const { userId } = req.params    const [projects] = await pool.execute(
      `SELECT p.*, COUNT(pm.id) as memberCount       FROM projects p       LEFT JOIN project_members pm ON p.id = pm.project_id AND pm.status = 'active'       WHERE p.created_by_id = ?       GROUP BY p.id       ORDER BY p.created_at DESC`,      [userId]
    )
    res.json({ success: true, data: projects })
  } catch (error) {
    console.error('è·å–æˆ‘çš„é¡¹ç›®å¤±è´¥:', error)
    res.status(500).json({ success: false, error: 'è·å–é¡¹ç›®å¤±è´¥' })
  }
})
// è·å–é¡¹ç›®æˆå‘˜app.get('/api/team/project-members/:projectId', async (req, res) => {
  try {
    const { projectId } = req.params    const [members] = await pool.execute(
      `SELECT pm.*, u.username       FROM project_members pm       LEFT JOIN users u ON pm.user_id = u.id       WHERE pm.project_id = ?       ORDER BY pm.joined_at ASC`,      [projectId]
    )
    res.json({ success: true, data: members })
  } catch (error) {
    console.error('è·å–é¡¹ç›®æˆå‘˜å¤±è´¥:', error)
    res.status(500).json({ success: false, error: 'è·å–æˆå‘˜å¤±è´¥' })
  }
})
// ç§»é™¤æˆå‘˜app.post('/api/team/remove-member', async (req, res) => {
  try {
    const { projectId, userId } = req.body    // æ£€æŸ¥é¡¹ç›®æ˜¯å¦å­˜åœ¨    const [projects] = await pool.execute('SELECT * FROM projects WHERE id = ?', [projectId])
    if (projects.length === 0) {
      return res.status(404).json({ success: false, error: 'é¡¹ç›®ä¸å­˜åœ¨' })
    }
    // æ£€æŸ¥æˆå‘˜æ˜¯å¦å­˜åœ¨    const [members] = await pool.execute(
      'SELECT * FROM project_members WHERE project_id = ? AND user_id = ?',      [projectId, userId]
    )
    if (members.length === 0) {
      return res.status(404).json({ success: false, error: 'æˆå‘˜ä¸å­˜åœ¨' })
    }
    // åˆ é™¤æˆå‘˜    await pool.execute(
      'DELETE FROM project_members WHERE project_id = ? AND user_id = ?',      [projectId, userId]
    )
    res.json({ success: true, message: 'æˆå‘˜ç§»é™¤æˆåŠŸ' })
  } catch (error) {
    console.error('ç§»é™¤æˆå‘˜å¤±è´¥:', error)
    res.status(500).json({ success: false, error: 'ç§»é™¤æˆå‘˜å¤±è´¥' })
  }
})
// åˆ‡æ¢æˆå‘˜æ‹‰é»‘çŠ¶æ€app.post('/api/team/toggle-ban-member', async (req, res) => {
  try {
    const { projectId, userId } = req.body    // è·å–å½“å‰çŠ¶æ€    const [members] = await pool.execute(
      'SELECT * FROM project_members WHERE project_id = ? AND user_id = ?',      [projectId, userId]
    )
    if (members.length === 0) {
      return res.status(404).json({ success: false, error: 'æˆå‘˜ä¸å­˜åœ¨' })
    }
    const currentStatus = members[0].status    const newStatus = currentStatus === 'active' ? 'inactive' : 'active'    // æ›´æ–°çŠ¶æ€    await pool.execute(
      'UPDATE project_members SET status = ? WHERE project_id = ? AND user_id = ?',      [newStatus, projectId, userId]
    )
    const message = newStatus === 'inactive' ? 'æˆå‘˜å·²æ‹‰é»‘' : 'æˆå‘˜å·²è§£å°'    res.json({ success: true, message: message })
  } catch (error) {
    console.error('åˆ‡æ¢æˆå‘˜çŠ¶æ€å¤±è´¥:', error)
    res.status(500).json({ success: false, error: 'æ“ä½œå¤±è´¥' })
  }
})
// é‚€è¯·æˆå‘˜app.post('/api/team/invite-member', async (req, res) => {
  try {
    const { projectId, username, message } = req.body    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨    const [users] = await pool.execute('SELECT * FROM users WHERE username = ?', [username])
    if (users.length === 0) {
      return res.status(404).json({ success: false, error: 'ç”¨æˆ·ä¸å­˜åœ¨' })
    }
    const inviteeId = users[0].id    // æ£€æŸ¥æ˜¯å¦å·²ç»æ˜¯æˆå‘˜    const [existingMembers] = await pool.execute(
      'SELECT * FROM project_members WHERE project_id = ? AND user_id = ?',      [projectId, inviteeId]
    )
    if (existingMembers.length > 0) {
      return res.status(400).json({ success: false, error: 'ç”¨æˆ·å·²ç»æ˜¯é¡¹ç›®æˆå‘˜' })
    }
    // æ£€æŸ¥æ˜¯å¦æœ‰å¾…å¤„ç†çš„é‚€è¯·    const [existingInvites] = await pool.execute(
      'SELECT * FROM project_invitations WHERE project_id = ? AND invitee_id = ? AND status = "pending"',      [projectId, inviteeId]
    )
    if (existingInvites.length > 0) {
      return res.status(400).json({ success: false, error: 'å·²å­˜åœ¨å¾…å¤„ç†çš„é‚€è¯·' })
    }
    // åˆ›å»ºé‚€è¯·    await pool.execute(
      `INSERT INTO project_invitations (project_id, inviter_id, invitee_id, message, status, created_at)       VALUES (?, ?, ?, ?, 'pending', NOW())`,      [projectId, req.body.inviterId || 1, inviteeId, message]
    )
    res.json({ success: true, message: 'é‚€è¯·å‘é€æˆåŠŸ' })
  } catch (error) {
    console.error('å‘é€é‚€è¯·å¤±è´¥:', error)
    res.status(500).json({ success: false, error: 'å‘é€é‚€è¯·å¤±è´¥' })
  }
})
```

### ç¬¬ä¸ƒé˜¶æ®µï¼šå¥½å‹èŠå¤©åŠŸèƒ½å®ç°

### 7.1 å¥½å‹ç³»ç»Ÿå®ç°

**é—®é¢˜13ï¼šå¦‚ä½•å®ç°åŒå‘å¥½å‹å…³ç³»ï¼Ÿ**

æˆ‘ä»¬è®¾è®¡äº†åŒå‘å¥½å‹å…³ç³»ç³»ç»Ÿï¼š

```jsx
// backend/index.js:å¥½å‹ç³»ç»ŸAPI// æ·»åŠ å¥½å‹app.post('/api/friends/add', async (req, res) => {
  try {
    const { userId, friendUsername } = req.body    // æ£€æŸ¥å¥½å‹æ˜¯å¦å­˜åœ¨    const [users] = await pool.execute('SELECT * FROM users WHERE username = ?', [friendUsername])
    if (users.length === 0) {
      return res.status(404).json({ success: false, error: 'ç”¨æˆ·ä¸å­˜åœ¨' })
    }
    const friendId = users[0].id    // æ£€æŸ¥æ˜¯å¦å·²ç»æ˜¯å¥½å‹    const [existingFriendships] = await pool.execute(
      'SELECT * FROM friendships WHERE user_id = ? AND friend_id = ?',      [userId, friendId]
    )
    if (existingFriendships.length > 0) {
      return res.status(400).json({ success: false, error: 'å·²ç»æ˜¯å¥½å‹å…³ç³»' })
    }
    // åˆ›å»ºå¥½å‹è¯·æ±‚    await pool.execute(
      `INSERT INTO friendships (user_id, friend_id, status, created_at)       VALUES (?, ?, 'pending', NOW())`,      [userId, friendId]
    )
    res.json({ success: true, message: 'å¥½å‹è¯·æ±‚å‘é€æˆåŠŸ' })
  } catch (error) {
    console.error('æ·»åŠ å¥½å‹å¤±è´¥:', error)
    res.status(500).json({ success: false, error: 'æ·»åŠ å¥½å‹å¤±è´¥' })
  }
})
// å“åº”å¥½å‹è¯·æ±‚app.post('/api/friends/respond', async (req, res) => {
  try {
    const { userId, friendId, action } = req.body // action: 'accept' æˆ– 'reject'    const newStatus = action === 'accept' ? 'accepted' : 'rejected'    // æ›´æ–°å¥½å‹è¯·æ±‚çŠ¶æ€    const [result] = await pool.execute(
      'UPDATE friendships SET status = ?, updated_at = NOW() WHERE user_id = ? AND friend_id = ?',      [newStatus, friendId, userId] // æ³¨æ„ï¼šè¿™é‡ŒfriendIdæ˜¯å‘èµ·è€…ï¼ŒuserIdæ˜¯å“åº”è€…    )
    if (result.affectedRows === 0) {
      return res.status(404).json({ success: false, error: 'å¥½å‹è¯·æ±‚ä¸å­˜åœ¨' })
    }
    if (action === 'accept') {
      // åˆ›å»ºåå‘å¥½å‹å…³ç³»      await pool.execute(
        `INSERT INTO friendships (user_id, friend_id, status, created_at)         VALUES (?, ?, 'accepted', NOW())         ON DUPLICATE KEY UPDATE status = VALUES(status), updated_at = NOW()`,        [userId, friendId] // userIdæ˜¯å“åº”è€…ï¼ŒfriendIdæ˜¯å‘èµ·è€…      )
    }
    const message = action === 'accept' ? 'å¥½å‹è¯·æ±‚å·²æ¥å—' : 'å¥½å‹è¯·æ±‚å·²æ‹’ç»'    res.json({ success: true, message: message })
  } catch (error) {
    console.error('å¤„ç†å¥½å‹è¯·æ±‚å¤±è´¥:', error)
    res.status(500).json({ success: false, error: 'å¤„ç†å¥½å‹è¯·æ±‚å¤±è´¥' })
  }
})
```

### 7.2 èŠå¤©ç•Œé¢å®ç°

```
<!-- frontend/src/views/Friends.vue -->
<template>
  <div class="friends-container">
    <div class="friends-sidebar">
      <!-- å¥½å‹åˆ—è¡¨ -->
      <div class="friends-list">
        <h3>å¥½å‹åˆ—è¡¨</h3>
        <div v-for="friend in friends" :key="friend.id"
             :class="['friend-item', { active: selectedFriend?.id === friend.id }]"
             @click="openChat(friend)">
          <div class="friend-avatar">{{ friend.username.charAt(0) }}</div>
          <div class="friend-info">
            <div class="friend-name">{{ friend.username }}</div>
            <div class="friend-status">åœ¨çº¿</div>
          </div>
        </div>
      </div>

      <!-- å¾…å¤„ç†çš„å¥½å‹è¯·æ±‚ -->
      <div class="pending-requests">
        <h3>å¥½å‹è¯·æ±‚</h3>
        <div v-for="request in pendingRequests" :key="request.id" class="request-item">
          <div class="request-info">
            <span>{{ request.username }} è¯·æ±‚æ·»åŠ ä½ ä¸ºå¥½å‹</span>
          </div>
          <div class="request-actions">
            <button @click="respondToRequest(request.user_id, 'accept')">æ¥å—</button>
            <button @click="respondToRequest(request.user_id, 'reject')">æ‹’ç»</button>
          </div>
        </div>
      </div>
    </div>

    <!-- èŠå¤©çª—å£ -->
    <div class="chat-window">
      <div v-if="selectedFriend" class="chat-header">
        <h3>{{ selectedFriend.username }}</h3>
      </div>

      <div class="chat-messages" ref="chatMessages">
        <div v-for="message in chatMessages" :key="message.id"
             :class="['message', message.sender_id === currentUser.id ? 'sent' : 'received']">
          <div class="message-content">{{ message.message }}</div>
          <div class="message-time">{{ formatDate(message.created_at) }}</div>
        </div>
      </div>

      <div class="chat-input">
        <input v-model="newMessage" @keyup.enter="sendMessage" placeholder="è¾“å…¥æ¶ˆæ¯...">
        <button @click="sendMessage">å‘é€</button>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      friends: [],
      pendingRequests: [],
      selectedFriend: null,
      chatMessages: [],
      newMessage: '',
      currentUser: null
    }
  },

  async mounted() {
    this.currentUser = JSON.parse(localStorage.getItem('currentUser'))
    await this.loadFriends()
    await this.loadPendingRequests()
  },

  methods: {
    async loadFriends() {
      try {
        const response = await fetch(`http://39.108.142.250:3000/api/friends/${this.currentUser.id}`)
        const result = await response.json()

        if (result.success) {
          this.friends = result.data
        }
      } catch (error) {
        console.error('åŠ è½½å¥½å‹åˆ—è¡¨å¤±è´¥:', error)
      }
    },

    async loadPendingRequests() {
      try {
        const response = await fetch(`http://39.108.142.250:3000/api/friends/pending/${this.currentUser.id}`)
        const result = await response.json()

        if (result.success) {
          this.pendingRequests = result.data
        }
      } catch (error) {
        console.error('åŠ è½½å¾…å¤„ç†è¯·æ±‚å¤±è´¥:', error)
      }
    },

    async respondToRequest(friendId, action) {
      try {
        const response = await fetch('http://39.108.142.250:3000/api/friends/respond', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            userId: this.currentUser.id,
            friendId: friendId,
            action: action
          })
        })

        const result = await response.json()

        if (result.success) {
          alert(result.message)
          await this.loadPendingRequests()
          if (action === 'accept') {
            await this.loadFriends()
          }
        } else {
          alert('å¤„ç†å¤±è´¥: ' + result.error)
        }
      } catch (error) {
        console.error('å¤„ç†å¥½å‹è¯·æ±‚å¤±è´¥:', error)
        alert('å¤„ç†å¤±è´¥')
      }
    },

    async openChat(friend) {
      this.selectedFriend = friend
      await this.loadChatHistory(friend.id)
    },

    async loadChatHistory(friendId) {
      try {
        const response = await fetch(`http://39.108.142.250:3000/api/friends/chat/${this.currentUser.id}/${friendId}`)
        const result = await response.json()

        if (result.success) {
          this.chatMessages = result.data
          this.$nextTick(() => {
            this.scrollToBottom()
          })
        }
      } catch (error) {
        console.error('åŠ è½½èŠå¤©è®°å½•å¤±è´¥:', error)
      }
    },

    async sendMessage() {
      if (!this.newMessage.trim() || !this.selectedFriend) return

      try {
        const response = await fetch('http://39.108.142.250:3000/api/friends/chat/send', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            senderId: this.currentUser.id,
            receiverId: this.selectedFriend.id,
            message: this.newMessage
          })
        })

        const result = await response.json()

        if (result.success) {
          this.newMessage = ''
          await this.loadChatHistory(this.selectedFriend.id)
        } else {
          alert('å‘é€å¤±è´¥: ' + result.error)
        }
      } catch (error) {
        console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', error)
        alert('å‘é€å¤±è´¥')
      }
    },

    scrollToBottom() {
      const container = this.$refs.chatMessages
      if (container) {
        container.scrollTop = container.scrollHeight
      }
    },

    formatDate(dateString) {
      const date = new Date(dateString)
      return date.toLocaleString('zh-CN')
    }
  }
}
</script>
```

### ç¬¬å…«é˜¶æ®µï¼šé—®é¢˜è§£å†³ä¸ä¼˜åŒ–

### 8.1 ä¸»è¦é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

**é—®é¢˜14ï¼šVueé¡¹ç›®é¢„è§ˆæ—¶å‡ºç°â€ref is not definedâ€é”™è¯¯**

**åŸå› åˆ†æï¼š** Vueç»„ä»¶é¢„è§ˆæ—¶ï¼ŒAIç”Ÿæˆçš„Vueç»„ä»¶ä½¿ç”¨äº†Composition APIçš„`ref`ã€`reactive`ç­‰å‡½æ•°ï¼Œä½†åœ¨é¢„è§ˆç¯å¢ƒä¸­æ²¡æœ‰æ­£ç¡®å¯¼å…¥è¿™äº›å‡½æ•°ã€‚

**è§£å†³æ–¹æ¡ˆï¼š** åœ¨Vueé¢„è§ˆçš„HTMLåŒ…è£…å™¨ä¸­æ˜¾å¼å¯¼å…¥Vueçš„Composition APIå‡½æ•°ï¼š

```jsx
// backend/index.js:1595-1596const { createApp, ref, reactive, computed, onMounted, onUnmounted } = Vue;const { createRouter, createWebHashHistory } = VueRouter;
```

**é—®é¢˜15ï¼šæ–‡ä»¶åˆ é™¤åä»ç„¶æ˜¾ç¤ºåœ¨åˆ—è¡¨ä¸­**

**åŸå› åˆ†æï¼š** æ–‡ä»¶åˆ é™¤é‡‡ç”¨äº†è½¯åˆ é™¤æœºåˆ¶ï¼Œä½†æ–‡ä»¶åˆ—è¡¨æŸ¥è¯¢æ—¶æ²¡æœ‰è¿‡æ»¤å·²åˆ é™¤çš„æ–‡ä»¶ã€‚

**è§£å†³æ–¹æ¡ˆï¼š** åœ¨æ–‡ä»¶åˆ—è¡¨æŸ¥è¯¢ä¸­æ·»åŠ çŠ¶æ€è¿‡æ»¤ï¼š

```jsx
// backend/services/projectService.js:908-971let query = `SELECT * FROM \`${tableName}\` WHERE status = 'active'`
```

**é—®é¢˜16ï¼šAIç”Ÿæˆçš„Vueé¡¹ç›®åŒ…å«é…ç½®æ–‡ä»¶å¯¼è‡´é¢„è§ˆå¤±è´¥**

**åŸå› åˆ†æï¼š** AIæç¤ºè¯æ²¡æœ‰æ˜ç¡®è¯´æ˜åªç”ŸæˆVueç»„ä»¶æ–‡ä»¶ï¼Œå¯¼è‡´ç”Ÿæˆäº†`index.html`ã€`main.js`ç­‰é…ç½®æ–‡ä»¶ã€‚

**è§£å†³æ–¹æ¡ˆï¼š** ä¿®æ”¹AIæç¤ºè¯ï¼Œæ˜ç¡®åªç”ŸæˆVueç»„ä»¶æ–‡ä»¶ï¼š

```jsx
// backend/services/projectTypeService.jsaiPrompt: `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„Vue.jså‰ç«¯å¼€å‘ä¸“å®¶ã€‚è¯·å¸®åŠ©ç”¨æˆ·æ„å»ºä¸€ä¸ªç°ä»£åŒ–çš„Vue3é¡¹ç›®ã€‚é‡è¦ï¼šåªç”ŸæˆVueç»„ä»¶æ–‡ä»¶ï¼Œä¸ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼å…·ä½“è¦æ±‚ï¼š1. åªç”ŸæˆVueç»„ä»¶æ–‡ä»¶ï¼š   - src/App.vue (æ ¹ç»„ä»¶)   - src/views/ (é¡µé¢ç»„ä»¶ï¼Œ.vueæ–‡ä»¶)   - src/components/ (å…¬å…±ç»„ä»¶ï¼Œ.vueæ–‡ä»¶)2. æ–‡ä»¶æ ¼å¼è¦æ±‚ï¼š   - æ‰€æœ‰ç»„ä»¶ä½¿ç”¨.vueå•æ–‡ä»¶ç»„ä»¶æ ¼å¼   - æ¯ä¸ªç»„ä»¶éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå¯ä»¥å•ç‹¬é¢„è§ˆ   - ä¸ä½¿ç”¨å¤–éƒ¨ä¾èµ–ï¼Œæ‰€æœ‰ä»£ç å†…è”`
```

**é—®é¢˜17ï¼šå¥½å‹å…³ç³»å•å‘æ€§é—®é¢˜**

**åŸå› åˆ†æï¼š** å¥½å‹å…³ç³»åˆ›å»ºæ—¶ï¼Œåªåˆ›å»ºäº†å•å‘å…³ç³»ï¼Œæ²¡æœ‰åˆ›å»ºåå‘å…³ç³»ã€‚

**è§£å†³æ–¹æ¡ˆï¼š** åœ¨æ¥å—å¥½å‹è¯·æ±‚æ—¶ï¼ŒåŒæ—¶åˆ›å»ºåå‘å¥½å‹å…³ç³»ï¼š

```jsx
// backend/index.js:å¥½å‹å“åº”APIif (action === 'accept') {
  // åˆ›å»ºåå‘å¥½å‹å…³ç³»  await pool.execute(
    `INSERT INTO friendships (user_id, friend_id, status, created_at)     VALUES (?, ?, 'accepted', NOW())     ON DUPLICATE KEY UPDATE status = VALUES(status), updated_at = NOW()`,    [userId, friendId]
  )
}
```

### 8.2 æ€§èƒ½ä¼˜åŒ–

**ä¼˜åŒ–1ï¼šæ•°æ®åº“è¿æ¥æ± é…ç½®**

```jsx
// backend/config/database.jsconst dbConfig = {
  connectionLimit: parseInt(process.env.DB_CONNECTION_LIMIT) || 10,  connectTimeout: parseInt(process.env.DB_CONNECT_TIMEOUT) || 60000,  family: 4};
```

**ä¼˜åŒ–2ï¼šæ–‡ä»¶é¢„è§ˆç¼“å­˜æ§åˆ¶**

```jsx
// backend/index.js:é¢„è§ˆAPIres.setHeader('Cache-Control', 'no-cache, no-store, must-revalidate')
res.setHeader('Pragma', 'no-cache')
res.setHeader('Expires', '0')
```

**ä¼˜åŒ–3ï¼šå‰ç«¯ç»„ä»¶æ‡’åŠ è½½**

```
<!-- frontend/src/views/MainApp.vue -->
<div v-if="activeLeftTab === 'fileTree'" class="tab-content">
  <FileTreeDisplay
    ref="fileTree"
    :project-id="currentProject ? currentProject.id : ''"
    :project-name="currentProject ? currentProject.name : ''"
    @refresh="refreshFileManager"
    @file-selected="onFileSelected"
    @edit-item="onFileSelected"
  />
</div>
```

### ç¬¬ä¹é˜¶æ®µï¼šé¡¹ç›®éƒ¨ç½²ä¸æµ‹è¯•

### 9.1 ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

**å‰ç«¯éƒ¨ç½²ï¼š**

```bash
cd frontend
npm run build
# å°†distæ–‡ä»¶å¤¹éƒ¨ç½²åˆ°é™æ€æ–‡ä»¶æœåŠ¡å™¨
```

**åç«¯éƒ¨ç½²ï¼š**

```bash
cd backend
# å®‰è£…PM2è¿›ç¨‹ç®¡ç†å™¨npm install -g pm2
# å¯åŠ¨åç«¯æœåŠ¡pm2 start index.js --name "autoai-backend"# æŸ¥çœ‹æœåŠ¡çŠ¶æ€pm2 status
# æŸ¥çœ‹æ—¥å¿—pm2 logs autoai-backend
```

### 9.2 ç¯å¢ƒå˜é‡é…ç½®

```bash
# backend/.envDB_HOST=39.108.142.250
DB_PORT=3306
DB_USER=wslop
DB_PASSWORD=345345
DB_NAME=autoai
DEEPSEEK_API_KEY=your_deepseek_api_key
JWT_SECRET=your_jwt_secret
PORT=3000
NODE_ENV=production
```

### 9.3 æ•°æ®åº“åˆå§‹åŒ–

```sql
-- åˆ›å»ºæ•°æ®åº“CREATE DATABASE IF NOT EXISTS autoai CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
-- ä½¿ç”¨æ•°æ®åº“USE autoai;
-- æ‰§è¡Œinit-db.sqlè„šæœ¬SOURCE init-db.sql;
```

## é¡¹ç›®æ€»ç»“

### æŠ€æœ¯äº®ç‚¹

AutoAIé¡¹ç›®é›†æˆäº†å¤šç§å‰æ²¿æŠ€æœ¯ï¼Œå®ç°äº†ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

1. **AIä»£ç ç”Ÿæˆ**ï¼šåŸºäºDeepSeek APIçš„æ™ºèƒ½ä»£ç ç”Ÿæˆï¼Œæ”¯æŒå¤šç§é¡¹ç›®ç±»å‹
2. **3Dæ¨¡å‹äº¤äº’**ï¼šä½¿ç”¨Three.jså®ç°3Dæ¨¡å‹å±•ç¤ºå’Œè¯­éŸ³äº¤äº’
3. **å›¢é˜Ÿåä½œ**ï¼šå®Œæ•´çš„é¡¹ç›®æˆå‘˜ç®¡ç†å’Œæƒé™æ§åˆ¶ç³»ç»Ÿ
4. **å¥½å‹èŠå¤©**ï¼šå®æ—¶èŠå¤©åŠŸèƒ½å’Œå¥½å‹å…³ç³»ç®¡ç†
5. **æ™ºèƒ½é¢„è§ˆ**ï¼šæ”¯æŒå¤šç§æ–‡ä»¶ç±»å‹çš„å®æ—¶é¢„è§ˆåŠŸèƒ½

### é¡¹ç›®æ¶æ„ä¼˜åŠ¿

- **å‰åç«¯åˆ†ç¦»**ï¼šVue 3 + Node.jsçš„ç°ä»£åŒ–æ¶æ„
- **æ•°æ®åº“è®¾è®¡**ï¼šMySQLåŠ¨æ€è¡¨åˆ›å»ºï¼Œæ”¯æŒå¤šé¡¹ç›®éš”ç¦»
- **CDNéƒ¨ç½²**ï¼šé¿å…ES6æ¨¡å—å¯¼å…¥é—®é¢˜ï¼Œæé«˜å…¼å®¹æ€§
- **è¯­éŸ³äº¤äº’**ï¼šWeb Speech APIé›†æˆï¼Œæå‡ç”¨æˆ·ä½“éªŒ

### å¼€å‘å¿ƒå¾—

åœ¨å¼€å‘AutoAIé¡¹ç›®è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°äº†å¾ˆå¤šæŠ€æœ¯æŒ‘æˆ˜ï¼š

1. **Vueç»„ä»¶é¢„è§ˆé—®é¢˜**ï¼šæœ€åˆAIç”Ÿæˆçš„Vueé¡¹ç›®åŒ…å«é…ç½®æ–‡ä»¶ï¼Œå¯¼è‡´é¢„è§ˆå¤±è´¥ã€‚é€šè¿‡ä¿®æ”¹AIæç¤ºè¯ï¼Œåªç”ŸæˆVueç»„ä»¶æ–‡ä»¶ï¼Œè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚
2. **æ–‡ä»¶åˆ é™¤å†²çª**ï¼šå¤šä¸ªç»„ä»¶åŒæ—¶è§¦å‘åˆ é™¤è¯·æ±‚å¯¼è‡´400é”™è¯¯ã€‚é€šè¿‡å®ç°å…¨å±€åˆ é™¤é”æœºåˆ¶ï¼Œé¿å…äº†é‡å¤åˆ é™¤è¯·æ±‚ã€‚
3. **å¥½å‹å…³ç³»åŒå‘æ€§**ï¼šåˆå§‹å®ç°çš„å¥½å‹å…³ç³»æ˜¯å•å‘çš„ï¼Œé€šè¿‡ä¿®æ­£æ•°æ®åº“æŸ¥è¯¢é€»è¾‘ï¼Œå®ç°äº†çœŸæ­£çš„åŒå‘å¥½å‹å…³ç³»ã€‚
4. **è¯­éŸ³è¯†åˆ«é›†æˆ**ï¼š3Dæ¨¡å‹ä¸è¯­éŸ³è¯†åˆ«çš„ç»“åˆéœ€è¦å¤„ç†å¤šç§äº¤äº’åœºæ™¯ï¼Œé€šè¿‡é¢„è®¾å›ç­”å’Œå¿«æ·æŒ‡ä»¤çš„æœºåˆ¶ï¼Œæä¾›äº†ä¸°å¯Œçš„äº¤äº’ä½“éªŒã€‚

### æœªæ¥è§„åˆ’

AutoAIé¡¹ç›®è¿˜æœ‰å¾ˆå¤§çš„å‘å±•ç©ºé—´ï¼Œæœªæ¥è®¡åˆ’å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š

1. **æ›´å¤šAIæ¨¡å‹æ”¯æŒ**ï¼šé›†æˆæ›´å¤šAIæœåŠ¡æä¾›å•†ï¼Œæä¾›æ›´ä¸°å¯Œçš„ä»£ç ç”Ÿæˆé€‰é¡¹
2. **å®æ—¶åä½œç¼–è¾‘**ï¼šå®ç°å¤šç”¨æˆ·åŒæ—¶ç¼–è¾‘é¡¹ç›®çš„åŠŸèƒ½
3. **é¡¹ç›®æ¨¡æ¿åº“**ï¼šå»ºç«‹ä¸°å¯Œçš„é¡¹ç›®æ¨¡æ¿åº“ï¼Œæé«˜å¼€å‘æ•ˆç‡
4. **ç§»åŠ¨ç«¯é€‚é…**ï¼šå¼€å‘ç§»åŠ¨ç«¯åº”ç”¨ï¼Œæ”¯æŒéšæ—¶éšåœ°è®¿é—®é¡¹ç›®
5. **æ’ä»¶ç³»ç»Ÿ**ï¼šå¼€å‘æ’ä»¶ç³»ç»Ÿï¼Œæ”¯æŒç¬¬ä¸‰æ–¹åŠŸèƒ½æ‰©å±•

### ç»“è¯­

AutoAIé¡¹ç›®æ˜¯ä¸€ä¸ªé›†æˆäº†AIã€3Dã€åä½œç­‰å¤šç§æŠ€æœ¯çš„ç»¼åˆæ€§å¹³å°ï¼Œå®ƒä¸ä»…å±•ç¤ºäº†ç°ä»£Webå¼€å‘çš„æŠ€æœ¯å®åŠ›ï¼Œæ›´é‡è¦çš„æ˜¯ä¸ºç”¨æˆ·æä¾›äº†ä¸€ä¸ªæ™ºèƒ½åŒ–çš„å¼€å‘ç¯å¢ƒã€‚é€šè¿‡æŒç»­çš„æŠ€æœ¯åˆ›æ–°å’ŒåŠŸèƒ½å®Œå–„ï¼ŒAutoAIå°†æˆä¸ºå¼€å‘è€…ä»¬ä¸å¯æˆ–ç¼ºçš„æ™ºèƒ½åŠ©æ‰‹ã€‚

![image.png](image.png)

é¡¹ç›®å®Œæˆ

**åœ¨çº¿æ¼”ç¤º**ï¼š[http://39.108.142.250/]

---

*æœ¬æ–‡æ¡£è¯¦ç»†è®°å½•äº†AutoAIé¡¹ç›®ä»æ„æ€åˆ°å®ç°çš„å®Œæ•´è¿‡ç¨‹ï¼ŒåŒ…æ‹¬æŠ€æœ¯é€‰å‹ã€æ¶æ„è®¾è®¡ã€åŠŸèƒ½å®ç°ã€é—®é¢˜è§£å†³ç­‰å„ä¸ªæ–¹é¢ï¼Œä¸ºç±»ä¼¼é¡¹ç›®çš„å¼€å‘æä¾›äº†å®è´µçš„å‚è€ƒç»éªŒã€‚*